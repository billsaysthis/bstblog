---
layout: post
title: My Experimental Ajax FeedReader
date: 2007-06-04 21:44:00.000000000 -07:00
type: post
published: true
status: publish
categories:
- Personal
tags: []
meta:
  blogger_blog: bsstqwerty.blogspot.com
  blogger_author: BillSaysThis
  blogger_76d35d3480289f8abae3c7a1f3961b60_permalink: '4280817145576714023'
  _twitterrelated_short_url: http://bit.ly/cv4usw
  _twitterrelated_short_urlHash: e5f9ae1f08bb26d011f324285e2ca486
  _activeshortener: bitly
  original_post_id: '4560'
  _wp_old_slug: '4560'
author:
  login: blazar
  email: blazar@gmail.com
  display_name: BillSaysThis
  first_name: ''
  last_name: ''
---
<p><span style="font-style:italic;">Disclaimer:</span> I'm not claiming either my code or design are especially original or high quality. I just have fun teaching myself this stuff and am writing about it for my own future memory. Having said that if you'd like a copy of the code and instructions <span style="font-style:italic;font-weight:bold;">for use as is and with no support</span>, drop me a line and I may send it back.</p>
<p>The idea for <a href="http://billsaysthis.com/content/misc/blogroll_reader.php">this Ajax feedreader</a> came to me last week at the Google Developer Day. My code, written in PHP, takes as input an OPML file (I used a file generated by Vienna's export subscriptions function) and puts each folder of feeds into its own tab. Separate Google FeedReader controls are instantiated for each tab but not drawn until the specific tab is clicked using MooTool's event handling; the tab labels come from the OPML folder names. The first tab is auto-loaded.</p>
<p>You need three key pieces to follow along:
<ul>
<li><a href="http://mootools.net/">MooTools</a>, which I'm already using for the top of page slide in menu</li>
<li><a href="http://digitarald.de/playground/tabs.html">SimpleTabs</a> by Harald Kirschner, a MooTools add-on (I may also try and integrate his HistoryManager, but it isn't in yet)</li>
<li><a href="http://code.google.com/apis/ajaxfeeds/">Google AJAX Feeds API</a></li>
</ul>
<p>The first two are open source and must be downloaded and installed, to use the last you must sign up for a (free) API key.</p>
<p>Note that my code has some significant limitations:
<ul>
<li>I didn't work out how to constrict the width of the tab menu to the containing div so the number of tabs was whittled down to fit the space.</li>
<li>Feeds must be inside a folder, since the top level elements in the OPML file are used as the tabs--this could be corrected by testing the outline element but not something my sense of neatness needs.</li>
<li>Folders within folders are not supported for the same reason as mentioned in the previous bullet.</li>
</ul>
<p>Consider it a permanent beta.</p>
<p>PHP pseudo-code:
<pre><br />// My own CSS for the tabs and feedcontrol is after this pseudo-code block<br /><br />// MooTools, SimpleTabs and Google Feeds JavaScript and CSS files<br />// must be included, e.g.:<br />$st = "&lt;script type="text/javascript" src="http://www.google.com/jsapi?key=YOUR-GOOGLE-API-KEY"&gt;&lt;/script&gt;<br />  &lt;script type="text/javascript" src="/includes/js/mootools.v1.1.js"&gt;&lt;/script&gt;<br />  &lt;script type="text/javascript" src="/includes/js/simpletabs.js"&gt;&lt;/script&gt;<br />  &lt;link rel="stylesheet" type="text/css" href="/includes/css/simpletabs.css" /&gt;n";<br />// $dynamicJS is the JavaScript result of the PHP code below,<br />// so it obviously must be run before before this line<br />$st .= $dynamicJS;<br /><br />if(!$src = simplexml_load_file("your_sub_list.opml", "SimpleXMLElement", LIBXML_NOCDATA)) die('failed to load xml');<br /><br />// $jsFeedControl holds the dynamically generated JavaScript<br />// $t holds the HTML text<br />$jsFeedControl = "&lt;script type="text/javascript"&gt;<br />window.addEvent('domready', function() {<br />new SimpleTabs($('tab-block-1'), {entrySelector: 'h4'});n";<br />$t = "&lt;div id="tab-block-1"&gt;n";<br /><br />// $sections is the array of top-level elements, i.e., the folders<br />$sections = $src-&gt;xpath('body/outline');<br />$first = true;<br />foreach($sections as $sct) {<br />$sa = $sct-&gt;attributes();<br />// the tab's label<br />$ot = $sa['text'];<br />// name of the FeedControl for this tab<br />$fc = str_replace(" ", "", "fc".$ot);<br />// SimpleTabs converts the list of &lt;h4&gt; elements to the menu,<br />// with the subsequent div the place where the FeedControl will be drawn<br />$t .= "&lt;h4&gt;&lt;div id="".$fc."_id" class="stmenu"&gt;$ot&lt;/div&gt;&lt;/h4&gt;n&lt;div id="".$fc."_view"&gt;&lt;/div&gt;n";<br />// JS to create a FeedControl<br />$js = "var ".$fc." = new google.feeds.FeedControl();n";<br />// $af is the array of feeds in the current folder<br />$af = $sct-&gt;xpath('outline');<br />foreach($af as $a) {<br />$a = $a-&gt;attributes();<br />// JS to add the feed to the FeedControl<br />$js .= $fc.".addFeed('".htmlspecialchars($a['xmlUrl'])."', '".htmlspecialchars($a['text'], ENT_QUOTES)."');n";<br />}<br />// this tab's click event handler JS<br />$js .= "$('".$fc."_id').addEvent('click', function() {<br />".$fc.".draw($('".$fc."_view'));<br />})n";<br />if($first) {<br />// auto-load the first tab<br />$first = false;<br />$fjs = $fc.".draw($('".$fc."_view'));n";<br />}<br />$jsFeedControl .= $js;<br />}<br />$t .= "&lt;/div&gt;n";<br />$jsFeedControl .= $fjs."});n&lt;/script&gt;n";<br /><br />// related CSS, some of which is needed to counteract the styles<br />// set for the top of page slide-in section:<br />.stmenu {display: inline;}<br /><br />.tab-wrapper .gfc-resultsHeader, .tab-wrapper .gfc-results, .tab-wrapper .gf-result .gf-snippet, .tab-wrapper .gfc-result .gf-result .gf-author, .tab-wrapper .gfc-result, .tab-wrapper .gf-result, .tab-wrapper .gf-result .gf-title {display: block; width: auto;}<br />.tab-wrapper .gfc-results {background-color: #ffffff; color: #000;}<br />.tab-wrapper .gfc-resultsHeader .gfc-title {font: 146% bold; color: #000; background-color: #DBDBF0; margin-bottom: 0; border: none; border-top: 1px dotted #003366;}<br />.tab-wrapper .gf-result .gf-title a {text-decoration: underline; margin-right: 10px; color: #0000ff;}<br />.tab-wrapper .gfc-result .gf-result .gf-spacer, .tab-wrapper .gfc-result .gf-result .gf-author {display: none;}<br /></pre>
